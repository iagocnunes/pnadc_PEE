rm(list = ls())
options(survey.lonely.psu = "adjust")
options(OutDec=",")
library(dplyr);library(PNADcIBGE);library(survey);library(srvyr)

dados_pnadc <- read_pnadc ("PNADC_2019_visita1.txt", "input_PNADC_2019_visita1_20200826.txt")
dados_pnadc <- pnadc_labeller (dados_pnadc,
                               "dicionario_PNADC_microdados_2019_visita1_20200826.xls")
dados_pnadc$one <- 1

pnadc_plano <-     
  svydesign(            
    ids = ~ UPA,
    strata = ~ Estrato,
    weights = ~ V1031, # dependendo do tipo de pnad, a variável muda
    data = dados_pnadc,
    nest = TRUE
  )

df_pos <- data.frame(posest = unique(dados_pnadc$posest), Freq = unique(dados_pnadc$V1030))
pnadc_calib <- postStratify(pnadc_plano, ~posest, df_pos)
pnadc_fatores = weights(pnadc_calib) / weights(pnadc_plano)
boxplot(pnadc_fatores, horizontal = TRUE, xlab="Fatores de calibração")
saveRDS(pnadc_calib,"pnadc_calib_2019")
rm(list = ls())

pnadc_calib <- readRDS(file="pnadc_calib_2019") 
pnadc_calib <- as_survey_design(pnadc_calib)
options(scipen=999)
svytotal(~ one, pnadc_calib)

# Indicador 8A
pnadc1829 <- subset(pnadc_calib, V2009>=18&V2009<=29)
svyby(~VD3005, ~UF, pnadc1829, svymean, na.rm=T)
svymean(~VD3005, pnadc1829, na.rm=T)
svymean(~VD3005, subset(pnadc1829, UF=="Rondônia"|UF=="Acre"|UF=="Amazonas"|UF=="Roraima"|UF=="Pará"|UF=="Amapá"|UF=="Tocantins"), na.rm=T)
svymean(~VD3005, subset(pnadc1829, UF=="Maranhão"|UF=="Piauí"|UF=="Ceará"|UF=="Rio Grande do Norte"|UF=="Paraíba"|UF=="Pernambuco"|UF=="Alagoas"|UF=="Sergipe"|UF=="Bahia"), na.rm=T)
svymean(~VD3005, subset(pnadc1829, UF=="Minas Gerais"|UF=="Espírito Santo"|UF=="Rio de Janeiro"|UF=="São Paulo"), na.rm=T)
svymean(~VD3005, subset(pnadc1829, UF=="Paraná"|UF=="Santa Catarina"|UF=="Rio Grande do Sul"), na.rm=T)
svymean(~VD3005, subset(pnadc1829, UF=="Mato Grosso do Sul"|UF=="Mato Grosso"|UF=="Goiás"|UF=="Distrito Federal"), na.rm=T)

# Indicador 8B
pnadc1829 <- subset(pnadc_calib, V2009>=18&V2009<=29)
svyby(~VD3005, ~UF, subset(pnadc1829, V1022=="Rural"), svymean, na.rm=T)
svymean(~VD3005, subset(pnadc1829, V1022=="Rural")) #Brasil
svyby(~VD3005,~V1022=="Rural", subset(pnadc1829, UF=="Rondônia"|UF=="Acre"|UF=="Amazonas"|UF=="Roraima"|UF=="Pará"|UF=="Amapá"|UF=="Tocantins"), svymean, na.rm=T)
svyby(~VD3005,~V1022=="Rural", subset(pnadc1829, UF=="Maranhão"|UF=="Piauí"|UF=="Ceará"|UF=="Rio Grande do Norte"|UF=="Paraíba"|UF=="Pernambuco"|UF=="Alagoas"|UF=="Sergipe"|UF=="Bahia"), svymean, na.rm=T)
svyby(~VD3005,~V1022=="Rural", subset(pnadc1829, UF=="Minas Gerais"|UF=="Espírito Santo"|UF=="Rio de Janeiro"|UF=="São Paulo"), svymean, na.rm=T)
svyby(~VD3005,~V1022=="Rural", subset(pnadc1829, UF=="Paraná"|UF=="Santa Catarina"|UF=="Rio Grande do Sul"), svymean, na.rm=T)
svyby(~VD3005,~V1022=="Rural", subset(pnadc1829, UF=="Mato Grosso do Sul"|UF=="Mato Grosso"|UF=="Goiás"|UF=="Distrito Federal"), svymean, na.rm=T)

# Indicador 8C [PNADC/A/EDU]

pnadc1829 <- subset(pnadc_calib, V2009>=18&V2009<=29)

NORTE <- subset(pnadc1829, UF=="Rondônia"|UF=="Acre"|UF=="Amazonas"|UF=="Roraima"|UF=="Pará"|UF=="Amapá"|UF=="Tocantins")
NORDESTE <- subset(pnadc1829, UF=="Maranhão"|UF=="Piauí"|UF=="Ceará"|UF=="Rio Grande do Norte"|UF=="Paraíba"|UF=="Pernambuco"|UF=="Alagoas"|UF=="Sergipe"|UF=="Bahia")
SUDESTE <- subset(pnadc1829, UF=="Minas Gerais"|UF=="Espírito Santo"|UF=="Rio de Janeiro"|UF=="São Paulo")
SUL <- subset(pnadc1829, UF=="Paraná"|UF=="Santa Catarina"|UF=="Rio Grande do Sul")
CENTROEST <- subset(pnadc1829, UF=="Mato Grosso do Sul"|UF=="Mato Grosso"|UF=="Goiás"|UF=="Distrito Federal")
Rondonia <- subset(pnadc1829, UF=="Rondônia")
Acre <- subset(pnadc1829, UF=="Acre")
Amazonas <- subset(pnadc1829, UF=="Amazonas")
Roraima <- subset(pnadc1829, UF=="Roraima")
Para <- subset(pnadc1829, UF=="Pará")
Amapa <- subset(pnadc1829, UF=="Amapá")
Tocantins <- subset(pnadc1829, UF=="Tocantins")
Maranhao <- subset(pnadc1829, UF=="Maranhão")
Piaui <- subset(pnadc1829, UF=="Piauí")
Ceara <- subset(pnadc1829, UF=="Ceará")
RN <- subset(pnadc1829, UF=="Rio Grande do Norte")
Paraiba <- subset(pnadc1829, UF=="Paraíba")
Pernambuco <- subset(pnadc1829, UF=="Pernambuco")
Alagoas <- subset(pnadc1829, UF=="Alagoas")
Sergipe <- subset(pnadc1829, UF=="Sergipe")
Bahia <- subset(pnadc1829, UF=="Bahia")
MG <- subset(pnadc1829, UF=="Minas Gerais")
ES <- subset(pnadc1829, UF=="Espírito Santo")
RJ <- subset(pnadc1829, UF=="Rio de Janeiro")
SP <- subset(pnadc1829, UF=="São Paulo")
Parana <- subset(pnadc1829, UF=="Paraná")
SC <- subset(pnadc1829, UF=="Santa Catarina")
RS <- subset(pnadc1829, UF=="Rio Grande do Sul")
MS <- subset(pnadc1829, UF=="Mato Grosso do Sul")
MT <- subset(pnadc1829, UF=="Mato Grosso")
Goias <- subset(pnadc1829, UF=="Goiás")
DF <- subset(pnadc1829, UF=="Distrito Federal")

svyquantile(~VDI5008, NORTE, quantiles= .25, na.rm=T)
svyquantile(~VDI5008, NORDESTE, quantiles= .25, na.rm=T)
svyquantile(~VDI5008, SUDESTE, quantiles= .25, na.rm=T)
svyquantile(~VDI5008, SUL, quantiles= .25, na.rm=T)
svyquantile(~VDI5008, CENTROEST, quantiles= .25, na.rm=T)
svyquantile(~VDI5008, pnadc1829, quantiles= .25, na.rm=T)
svyquantile(~VDI5008, Rondonia, quantiles= .25, na.rm=T)
svyquantile(~VDI5008, Acre, quantiles= .25, na.rm=T)
svyquantile(~VDI5008, Amazonas, quantiles= .25, na.rm=T)
svyquantile(~VDI5008, Roraima, quantiles= .25, na.rm=T)
svyquantile(~VDI5008, Para, quantiles= .25, na.rm=T)
svyquantile(~VDI5008, Amapa, quantiles= .25, na.rm=T)
svyquantile(~VDI5008, Tocantins, quantiles= .25, na.rm=T)
svyquantile(~VDI5008, Maranhao, quantiles= .25, na.rm=T)
svyquantile(~VDI5008, Piaui, quantiles= .25, na.rm=T)
svyquantile(~VDI5008, Ceara, quantiles= .25, na.rm=T)
svyquantile(~VDI5008, RN, quantiles= .25, na.rm=T)
svyquantile(~VDI5008, Paraiba, quantiles= .25, na.rm=T)
svyquantile(~VDI5008, Pernambuco, quantiles= .25, na.rm=T)
svyquantile(~VDI5008, Alagoas, quantiles= .25, na.rm=T)
svyquantile(~VDI5008, Sergipe, quantiles= .25, na.rm=T)
svyquantile(~VDI5008, Bahia, quantiles= .25, na.rm=T)
svyquantile(~VDI5008, MG, quantiles= .25, na.rm=T)
svyquantile(~VDI5008, ES, quantiles= .25, na.rm=T)
svyquantile(~VDI5008, RJ, quantiles= .25, na.rm=T)
svyquantile(~VDI5008, SP, quantiles= .25, na.rm=T)
svyquantile(~VDI5008, Parana, quantiles= .25, na.rm=T)
svyquantile(~VDI5008, SC, quantiles= .25, na.rm=T)
svyquantile(~VDI5008, RS, quantiles= .25, na.rm=T)
svyquantile(~VDI5008, MS, quantiles= .25, na.rm=T)
svyquantile(~VDI5008, MT, quantiles= .25, na.rm=T)
svyquantile(~VDI5008, Goias, quantiles= .25, na.rm=T)
svyquantile(~VDI5008, DF, quantiles= .25, na.rm=T)

svymean(~VD3005, subset(NORTE, VDI5008<=266,2163), na.rm=T)
svymean(~VD3005, subset(NORDESTE, VDI5008<=250), na.rm=T)
svymean(~VD3005, subset(SUDESTE, VDI5008<=564), na.rm=T)
svymean(~VD3005, subset(SUL, VDI5008<=667), na.rm=T)
svymean(~VD3005, subset(CENTROEST, VDI5008<=550), na.rm=T)
svymean(~VD3005, subset(pnadc1829, VDI5008<=400), na.rm=T)
svymean(~VD3005, subset(Rondonia, VDI5008<=424), na.rm=T)
svymean(~VD3005, subset(Acre, VDI5008<=219,4397), na.rm=T)
svymean(~VD3005, subset(Amazonas, VDI5008<=250), na.rm=T)
svymean(~VD3005, subset(Roraima, VDI5008<=310), na.rm=T)
svymean(~VD3005, subset(Para, VDI5008<=250), na.rm=T)
svymean(~VD3005, subset(Amapa, VDI5008<=293), na.rm=T)
svymean(~VD3005, subset(Tocantins, VDI5008<=340), na.rm=T)
svymean(~VD3005, subset(Maranhao, VDI5008<=193), na.rm=T)
svymean(~VD3005, subset(Piaui, VDI5008<=251), na.rm=T)
svymean(~VD3005, subset(Ceara, VDI5008<=267), na.rm=T)
svymean(~VD3005, subset(RN, VDI5008<=286), na.rm=T)
svymean(~VD3005, subset(Paraiba, VDI5008<=251,1756), na.rm=T)
svymean(~VD3005, subset(Pernambuco, VDI5008<=249), na.rm=T)
svymean(~VD3005, subset(Alagoas, VDI5008<=216,0069), na.rm=T)
svymean(~VD3005, subset(Sergipe, VDI5008<=258), na.rm=T)
svymean(~VD3005, subset(Bahia, VDI5008<=250), na.rm=T)
svymean(~VD3005, subset(MG, VDI5008<=500), na.rm=T)
svymean(~VD3005, subset(ES, VDI5008<=500), na.rm=T)
svymean(~VD3005, subset(RJ, VDI5008<=500), na.rm=T)
svymean(~VD3005, subset(SP, VDI5008<=628), na.rm=T)
svymean(~VD3005, subset(Parana, VDI5008<=600), na.rm=T)
svymean(~VD3005, subset(SC, VDI5008<=792,6827), na.rm=T)
svymean(~VD3005, subset(RS, VDI5008<=666), na.rm=T)
svymean(~VD3005, subset(MS, VDI5008<=566), na.rm=T)
svymean(~VD3005, subset(MT, VDI5008<=600), na.rm=T)
svymean(~VD3005, subset(Goias, VDI5008<=500), na.rm=T)
svymean(~VD3005, subset(DF, VDI5008<=660), na.rm=T)

# Indicador 8D
pnadc1829 <- subset(pnadc_calib, V2009>=18&V2009<=29)
pnadcBRAN <- subset(pnadc1829, V2010=="Branca"|V2010=="Amarela")
pnadcNEGR <- subset(pnadc1829, V2010=="Preta"|V2010=="Parda")
svymean(~VD3005, pnadcBRAN, na.rm=T)
svymean(~VD3005, pnadcNEGR, na.rm=T)
svyby(~VD3005, ~UF, pnadcBRAN, svymean, na.rm=T)
svyby(~VD3005, ~UF, pnadcNEGR, svymean, na.rm=T)

svymean(~VD3005, subset(pnadcBRAN, UF=="Rondônia"|UF=="Acre"|UF=="Amazonas"|UF=="Roraima"|UF=="Pará"|UF=="Amapá"|UF=="Tocantins"), na.rm=T)
svymean(~VD3005, subset(pnadcNEGR, UF=="Rondônia"|UF=="Acre"|UF=="Amazonas"|UF=="Roraima"|UF=="Pará"|UF=="Amapá"|UF=="Tocantins"), na.rm=T)
svymean(~VD3005, subset(pnadcBRAN, UF=="Maranhão"|UF=="Piauí"|UF=="Ceará"|UF=="Rio Grande do Norte"|UF=="Paraíba"|UF=="Pernambuco"|UF=="Alagoas"|UF=="Sergipe"|UF=="Bahia"), na.rm=T)
svymean(~VD3005, subset(pnadcNEGR, UF=="Maranhão"|UF=="Piauí"|UF=="Ceará"|UF=="Rio Grande do Norte"|UF=="Paraíba"|UF=="Pernambuco"|UF=="Alagoas"|UF=="Sergipe"|UF=="Bahia"), na.rm=T)
svymean(~VD3005, subset(pnadcBRAN, UF=="Minas Gerais"|UF=="Espírito Santo"|UF=="Rio de Janeiro"|UF=="São Paulo"), na.rm=T)
svymean(~VD3005, subset(pnadcNEGR, UF=="Minas Gerais"|UF=="Espírito Santo"|UF=="Rio de Janeiro"|UF=="São Paulo"), na.rm=T)
svymean(~VD3005, subset(pnadcBRAN, UF=="Paraná"|UF=="Santa Catarina"|UF=="Rio Grande do Sul"), na.rm=T)
svymean(~VD3005, subset(pnadcNEGR, UF=="Paraná"|UF=="Santa Catarina"|UF=="Rio Grande do Sul"), na.rm=T)
svymean(~VD3005, subset(pnadcBRAN, UF=="Mato Grosso do Sul"|UF=="Mato Grosso"|UF=="Goiás"|UF=="Distrito Federal"), na.rm=T)
svymean(~VD3005, subset(pnadcNEGR, UF=="Mato Grosso do Sul"|UF=="Mato Grosso"|UF=="Goiás"|UF=="Distrito Federal"), na.rm=T)
